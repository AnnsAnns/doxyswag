<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
  <head>
    <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=11" />
    <meta name="generator" content="Doxygen 1.12.0" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>RIOT OS: FIDO2 - Fast Identity Online 2</title>
    <link href="tabs.css" rel="stylesheet" type="text/css" />
    <script type="text/javascript" src="jquery.js"></script>
    <script type="text/javascript" src="dynsections.js"></script>
    <script type="text/javascript" src="clipboard.js"></script>
    <link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
    <link href="doxygen.css" rel="stylesheet" type="text/css" />
    <link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="global.css" rel="stylesheet" type="text/css"/>
    <!-- ... other metadata & script includes ... -->
    <script
      type="text/javascript"
      src="doxygen-awesome-paragraph-link.js"
    ></script>
      <script type="text/javascript" src="doxygen-awesome-interactive-toc.js"></script>
    <!-- <link href="pagefind/pagefind-ui.css" rel="stylesheet"> -->
    <script src="pagefind/pagefind-ui.js"></script>
    <script>
      // Check whether the PagefindUI class is available
      if (typeof PagefindUI === "undefined") {
        console.warn("PagefindUI class is not available | Dev Build");
      } else {
        // // Remove the "searchstub" element and initialize the PagefindUI class
        // document.getElementById("#searchstub").remove();
        // Initialize the PagefindUI class with the element id "search"
        window.addEventListener("DOMContentLoaded", (event) => {
          new PagefindUI({
            element: "#pagefindsearch",
            showSubResults: true,
            showImages: false,
            resetStyles: false,
            mergeFilter: {
              "Information Source": "API Documentation",
            },
            mergeIndex: [{
              bundlePath: "https://riot.annsann.eu/pagefind",
              mergeFilter: {
                "Information Source": "Guides",
              }
          }], 
          });
        });
      }
    </script>
  </head>
  <body>
    <div>
        <div id="top">
          <!-- do not remove this div, it is closed by doxygen! -->
          <div id="titlearea">
            <table cellspacing="0" cellpadding="0">
              <tbody>
                <tr id="projectrow">
                  <td id="projectlogo">
                    <img alt="Logo" src="riot-logo.svg"  />
                  </td>
                  <td id="projectalign">
                    <div id="projectname">
                      RIOT OS
                    </div>
                    <div id="projectbrief">The friendly Operating System for the Internet of Things</div>
                  </td>
                </tr>
              </tbody>
            </table>
            <div
              id="searchbox"
              class="searchboxui"
            >
                <button
                id="enable-search-box"
                class="searchbutton"
                >
                <p>üê∏üîé</p>
                <p>Search</p>
              </button>
              <div id="pagefindsearch" class="hidden"></div>
            </div>
          </div>
        </div>
        <script>
          /* When the user clicks on the button, toggle between hiding and showing the search box content */
          document.getElementById("enable-search-box").addEventListener("click", function () {
            var searchbox = document.getElementById("pagefindsearch");
            if (searchbox.classList.contains("hidden")) {
              searchbox.classList.remove("hidden");
              /* Focus on the search input field (classname pagefind-ui__search-input) */
              searchbox.querySelector(".pagefind-ui__search-input").focus();
            } else {
              searchbox.classList.add("hidden");
            }
          });
        </script>
        <!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',false,false,'search.php','Search',true);
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('group__fido2.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#groups">Topics</a>  </div>
  <div class="headertitle"><div class="title">FIDO2 - Fast Identity Online 2<div class="ingroups"><a class="el" href="group__sys.html">System</a></div></div></div>
</div><!--header-->
<div class="contents">

<p>Description of the FIDO2 CTAP implementation in RIOT  
<a href="#details">More...</a></p>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>Description of the FIDO2 CTAP implementation in RIOT </p>
<dl class="section author"><dt>Author</dt><dd>Nils Ollrogge <a href="#" onclick="location.href='mai'+'lto:'+'nil'+'s.'+'oll'+'ro'+'gge'+'@f'+'u-b'+'er'+'lin'+'.d'+'e'; return false;">nils.<span class="obfuscator">.nosp@m.</span>ollr<span class="obfuscator">.nosp@m.</span>ogge@<span class="obfuscator">.nosp@m.</span>fu-b<span class="obfuscator">.nosp@m.</span>erlin<span class="obfuscator">.nosp@m.</span>.de</a></dd></dl>
<dl class="section warning"><dt>Warning</dt><dd>This feature is experimental! This API is experimental and in an early state - expect changes.</dd>
<dd>
The FIDO2 implementation currently stores private keys in plain text inside flash memory.</dd>
<dd>
This implementation persists FIDO CTAP data across reboots and when unpowered; any firmware update loses the data because it will be overwritten. This applies both to firmware updates through bootloaders and to firmware updates through external programmers.</dd></dl>
<p>FIDO2 is an authentication standard that seeks to solve the password problem by enabling passwordless authentication. Instead of using passwords to authenticate to web services, FIDO2 enables users to use common devices (authenticators) to create cryptographic credentials which are then used for authentication. FIDO2 consists of the <a href="https://www.w3.org/TR/2019/REC-webauthn-1-20190304/">W3C Web Authentication specification (WebAuthn)</a> and the <a href="https://fidoalliance.org/specs/fido-v2.0-ps-20190130/fido-client-to-authenticator-protocol-v2.0-ps-20190130.html">Client to Authenticator Protocol (CTAP)</a>.</p>
<p><b>This code implements the FIDO2 CTAP protocol.</b></p>
<h3><a class="anchor" id="autotoc_md1967"></a>
General</h3>
<p>Following is an overview of the entities of this implementation and their relationships:</p>
<pre class="fragment">                +-----------+  +-----------+   +-----------+   +-----------+
                |           |  |           |   |           |   |           |
                | ctap_cbor |  |ctap_crypto|   | ctap_mem  |   |ctap_utils |
                |           |  |           |   |           |   |           |
                +-----------+  +-----------+   +-----------+   +-----|-----+
                      |             |               |                |
                      |             |               |                |
                      |         +---------------------------+        |
                      |         |                           |        |
                      |---------|           ctap            |--------|
                                |                           |
                                +---------------------------+
                                              |
                                +-------------|-------------+
                                |                           |
                                |       ctap_transport      |
                                |                           |
                                +---------------------------+
                                      |
                                      |
                                +-----------+
                                |           |
                                | ctap_hid  |
                                |           |
                                +-----------+
</pre><p><b>ctap_hid</b></p>
<p>USB Human Interface Device (USB HID) transport binding for CTAP (CTAPHID).</p>
<p>Initializes the USBUS HID interface.</p>
<p>Communicates with the USBUS USB HID interface through the USBUS HID IO interface.</p>
<p><b>ctap_transport</b></p>
<p>Initializes CTAP layer.</p>
<p>Initializes CTAP event queue.</p>
<p>Manages CTAP transport bindings (currently only CTAPHID).</p>
<p><b>ctap</b></p>
<p>Contains the main CTAP logic.</p>
<p>Makes use of helpers for flash access, cryptographic operations and CBOR operations.</p>
<p><b>ctap_cbor</b></p>
<p>Helper containing functionality to parse and encode CBOR messages. Uses the <a href="https://doc.riot-os.org/group__pkg__tinycbor.html">tinyCBOR</a> pkg.</p>
<p><b>ctap_crypto</b></p>
<p>Helper containing functionality for cryptographic operations.</p>
<p>Abstraction for cryptographic operations (SHA256, HMAC-SHA-256, AES CCM).</p>
<dl class="section note"><dt>Note</dt><dd>This abstraction exposes error return values which are currently not implemented in all cases by the RIOT crypto API.</dd></dl>
<p>Abstraction for Elliptic curve cryptography (ECC) operations. Uses the <a href="https://api.riot-os.org/group__pkg__micro__ecc.html">micro-ecc</a> pkg.</p>
<p>Parsing of cryptographic signatures into ASN.1 DER format. Uses the <a href="http://doc.riot-os.org/group__pkg__tiny-asn1.html">tiny-asn1</a> pkg.</p>
<p><b>ctap_mem</b></p>
<p>Abstraction for flash operations. Uses the RIOT <a href="http://api.riot-os.org/group__drivers__mtd__flashpage.html">Flashpage MTD driver</a>.</p>
<p>Flash memory is reserved at build time using the <code>FLASH_WRITABLE_INIT</code> macro. The amount of flashpages reserved can be configured as <code>FIDO2_CTAP_NUM_FLASHPAGES</code> in KConfig. The implementation needs at least 1 flashpage to store state information and 1 flashpage to store credentials also called resident keys (rks). Therefore, the minimum amount of flashpages needed is 2. State information is stored on the first flashpage, credentials (rks) on the following flashpages.</p>
<p>Adds additional functionality to speedup flash accesses (e.g. by checking if a flash page is erased to avoid unnecessary erasures of flash pages).</p>
<p><b>ctap_utils</b></p>
<p>Abstraction for GPIO functionality and LED animations.</p>
<h3><a class="anchor" id="autotoc_md1968"></a>
Implemented features</h3>
<p><b>FIDO2 CTAP methods</b></p>
<p>All methods defined in the FIDO2 CTAP specification are implemented. Specifically these are:</p><ul>
<li>MakeCredential</li>
<li>GetAssertion</li>
<li>GetNextAssertion</li>
<li>GetInfo</li>
<li>ClientPIN</li>
<li>Reset</li>
</ul>
<p>For information about the FIDO2 CTAP methods refer to the <a href="https://fidoalliance.org/specs/fido-v2.0-ps-20190130/fido-client-to-authenticator-protocol-v2.0-ps-20190130.html#authenticator-api">CTAP specification</a>.</p>
<p><b>Transport bindings</b></p>
<p>The USB Human Interface Device (USB HID) transport binding is fully implemented.</p>
<p>For more information about the available transport bindings refer to the <a href="https://fidoalliance.org/specs/fido-v2.0-ps-20190130/fido-client-to-authenticator-protocol-v2.0-ps-20190130.html#transport-specific-bindings">CTAP specification</a>.</p>
<p><b>Credentials</b></p>
<p>Both types of credentials are supported. Resident and non resident.</p>
<ul>
<li>Resident Credentials<ul>
<li>Resident credentials are credentials stored on the authenticator.</li>
<li>They are also called resident key (rk) credentials due to the key material being stored on the device.</li>
<li>This implementation stores resident keys in flash memory. <dl class="section warning"><dt>Warning</dt><dd>As of now the credentials (containing a private key) are stored in plain text inside flash memory</dd></dl>
</li>
</ul>
</li>
<li>Non-resident credentials<ul>
<li>Non-resident credentials are credentials that are stored by the relying party in encrypted form.</li>
<li>To encrypt the credentials, this implementation uses the RIOT <a href="https://api.riot-os.org/ccm_8h.html">AES-CCM 128 CCM implementation</a>.</li>
</ul>
</li>
</ul>
<p>For more information about the two types of credential refer to the <a href="https://www.w3.org/TR/2019/REC-webauthn-1-20190304/#sctn-credential-storage-modality">WebAuthn specification</a></p>
<p><b>Attestation types</b></p>
<p>Currently only self attestation is supported.</p>
<p>For more information about available attestation types refer to the <a href="https://www.w3.org/TR/2019/REC-webauthn-1-20190304/#sctn-attestation-types">WebAuthn specification</a>.</p>
<h3><a class="anchor" id="autotoc_md1969"></a>
Unimplemented features</h3>
<p><b>Backward compatibility with FIDO1</b></p>
<p>For more information about the backward compatibility of FIDO2 to FIDO1 refer to the <a href="https://fidoalliance.org/specs/fido-v2.0-ps-20190130/fido-client-to-authenticator-protocol-v2.0-ps-20190130.html#u2f-interoperability">CTAP specification</a>.</p>
<p><b>Support of further attestation types</b></p>
<p>Specifically these are:</p><ul>
<li>Basic Attestation</li>
<li>Attestation Certificate Authority</li>
<li>Elliptic Curve based Direct Anonymous Attestation</li>
</ul>
<p>For more information about available attestation types refer to the <a href="https://www.w3.org/TR/2019/REC-webauthn-1-20190304/#sctn-attestation-types">WebAuthn specification</a>.</p>
<p><b>Support of further transport bindings</b></p>
<p>Specifically these are:</p><ul>
<li>Near Field Communication (NFC)</li>
<li>Bluetooth Low Energy (BLE)</li>
</ul>
<p>For information about the available transport bindings refer to the <a href="https://fidoalliance.org/specs/fido-v2.0-ps-20190130/fido-client-to-authenticator-protocol-v2.0-ps-20190130.html#transport-specific-bindings">CTAP specification</a>.</p>
<p><b>Extensions</b></p>
<p>For information about CTAP extensions refer to the <a href="https://fidoalliance.org/specs/fido-v2.0-ps-20190130/fido-client-to-authenticator-protocol-v2.0-ps-20190130.html#sctn-defined-extensions">CTAP specification</a></p>
<p><b>CTAP 2.1 support</b></p>
<p>None of the additions from the <a href="https://fidoalliance.org/specs/fido-v2.1-ps-20210615/fido-client-to-authenticator-protocol-v2.1-ps-20210615.html">CTAP 2.1 specification</a> are implemented.</p>
<h3><a class="anchor" id="autotoc_md1970"></a>
Testing</h3>
<p>Testing is done with the help of the fido2-tests package based on the <a href="https://github.com/solokeys/fido2-tests">solokeys fido2-tests</a>.</p>
<p>For for more information about testing the FIDO2 CTAP implementation refer to the README of the test application (<code>/tests/sys/fido2_ctap</code>).</p>
<p><b>Todo</b></p>
<ul>
<li>The expected return codes of some tests were changed due to different opinions of how to interpret the CTAP2 specification. Refer to the <a href="https://github.com/solokeys/fido2-tests/issues/55">issue</a> for more information. As of writing this the issue is still open.</li>
</ul>
<h3><a class="anchor" id="autotoc_md1971"></a>
Configuration</h3>
<p>There are two CFLAGS which can be used to change the behavior of the FIDO2 CTAP implementation:</p>
<ul>
<li><b>FIDO2_CTAP_DISABLE_UP</b>: Disables the user presence test. User presence will always be set to true. This is helpful when running the fido2-tests as one doesn't have to click the button many times, as well as other use cases where no user presence test is wanted.</li>
<li><b>FIDO2_CTAP_DISABLE_LED</b>: Disables LED animations which are used to indicate that user action is needed.</li>
</ul>
<p>The CFLAGS can either be set in the Makefile or configured via KConfig.</p>
<h3><a class="anchor" id="autotoc_md1972"></a>
Future work</h3>
<p>Future improvements / extensions to the FIDO2 CTAP implementation that should be implemented are:</p>
<ul>
<li>Usage of secure elements if available to safely store private keys of FIDO2 credentials.</li>
<li>Usage of an extra cryptographic processor (e.g. <a href="https://infocenter.nordicsemi.com/index.jsp?topic=%2Fps_nrf9160%2Fcryptocell.html">ARM CryptoCell</a>) to improve efficiency and drop dependency for ECC cryptography.</li>
<li>Support of further attestation types.</li>
<li>Support of further CTAP transport bindings.</li>
<li>Support of CTAP 2.1. </li>
</ul>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="groups" name="groups"></a>
Topics</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__fido2__ctap.html">CTAP</a></td></tr>
<tr class="memdesc:group__fido2__ctap"><td class="mdescLeft">&#160;</td><td class="mdescRight">FIDO2 CTAP <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.12.0-->
<!-- start footer part -->
<div>
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Tue Oct 8 2024 10:42:47 for RIOT OS by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0 </li>
  </ul>
</div>
</div>
</body>
</html>
